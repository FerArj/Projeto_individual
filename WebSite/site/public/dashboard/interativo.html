<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="assets/img2/tardis_icon.png">
    <link rel="stylesheet" href="../css/style_interativo.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Doctor Who</title>
</head>


<body>
    <header>
        <div class="container">
            <div class="titulo">
                <!-- <h1>Doctor Who</h1> -->
                <img src="../assets/img2/logodw.png" alt="">
            </div>
            <div class="menu">
                <ul>
                    <li></li>
                    <!-- <li class="links"><a href="">Quiz</a></li> -->
            </div>
            <div class="cadastro-link">
                <li><a href="../index.html">SAIR</a></li>
            </div>
            </ul>
        </div>
    </header>

    <main>
        <div class="banner">
            <div class="container-interativo">
                <img class="back-video" src="../assets/img2/banner1.png" alt="">
                <h1 class="int-titulo">Bem vindo, <h1 id="h1_usuario">
                        <h1>.</h1>
                    </h1>
                </h1>
            </div>
        </div>

        <div id="conteudo1" class="conteudo1">
            <div class="container">
                <div class="caixas">
                    <div class="caixa">
                        <div>
                            <div class="chart-container" style="position: relative; height:40vh; width:40vw">
                                <canvas id="myChart"></canvas>
                            </div>
                            <img src="../assets/doctors/2th_doctor.png" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="conteudo2" class="conteudo2">
            <div class="container">
                <div class="caixas">
                    <div class="caixa">
                        <h3>JOGO DA FORCA</h3>
                        <p>Teste seu conhecimento nesse incrivel jogo da forca temático da série!</p>
                        <img src="../assets/img2/cyberman.png" alt="">

                        <a href="forca.html">
                            <div class="button">JOGAR</div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <footer>
        <div class="container">
            <p>Todos os direitos reservados para Fernando Araujo &copy; </p>
        </div>
    </footer>
</body>

</html>
<script src="../js/funcoes.js"></script>
<script>

    h1_usuario.innerHTML = sessionStorage.NOME_USUARIO;

    window.onload = obterDadosGrafico(1);
    window.onload = obterDadosGrafico(1000);


    function obterDadosGrafico(idAquario) {

        fetch(`/medidas/ultimas/${idAquario}`, { cache: 'no-store' }).then(function (response) {
            if (response.ok) {
                response.json().then(function (resposta) {
                    console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                    resposta.reverse();

                    plotarGrafico(resposta, idAquario);
                });
            } else {
                console.error('Nenhum dado encontrado ou erro na API');
            }
        })
            .catch(function (error) {
                console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
            });
    }

    function plotarGrafico(resposta, idAquario) {
        console.log('iniciando plotagem do gráfico...');

        // Criando estrutura para plotar gráfico - labels
        let labels = [];


        let dados = {
            labels: labels,
            datasets: [{
                label: 'VOTAÇÕES DE OUTROS USUÁRIOS',
                backgroundColor: '#e55743',
                borderColor: '#e55743',
                data: [],
            }]
        };

        // Criando estrutura para plotar gráfico - dados

        console.log('----------------------------------------------')
        console.log('Estes dados foram recebidos pela funcao "obterDadosGrafico" e passados para "plotarGrafico":')
        console.log(resposta)

        // Inserindo valores recebidos em estrutura para plotar o gráfico

        maior = 0;
        for (i = 0; i < resposta.length; i++) {
            var registro = resposta[i];
            maior = resposta[i]
            labels.push(registro.doutor);
            dados.datasets[0].data.push(registro.qtd);
        }

        alert(dados.datasets[0].data[maior])
        

        console.log('----------------------------------------------')
        console.log('O gráfico será plotado com os respectivos valores:')
        console.log('Labels:')
        console.log(labels)
        console.log('Dados:')
        console.log(dados.datasets)
        console.log('----------------------------------------------')

        // Criando estrutura para plotar gráfico - config
        const config = {
            type: 'bar',
            data: dados,
            options: {}
        };

        // Adicionando gráfico criado em div na tela
        let myChart = new Chart(
            document.getElementById('myChart'),
            config
        );

        // setTimeout(() => atualizarGrafico(idAquario, data, myChart), 2000);
    }


    // const labels = [
    //     '1th Doctor',
    //     '2th Doctor',
    //     '3th Doctor',
    //     '4th Doctor',
    //     '5th Doctor',
    //     '6th Doctor',
    //     '7th Doctor',
    //     '8th Doctor',
    //     'War Doctor',
    //     '9th Doctor',
    //     '10th Doctor',
    //     '11th Doctor',
    //     '12th Doctor',
    //     '13th Doctor',
    //     '14th Doctor',
    // ];

    // const data = {
    //     labels: labels,
    //     datasets: [{
    //         label: 'VOTAÇÕES DE USUÁRIOS',
    //         backgroundColor: '#598ff5',
    //         borderColor: '#598ff5',
    //         data: [50, 10, 5, 2, 20, 30, 45, 3, 10, 5, 2, 20, 30, 45, 4],
    //     }]
    // // };

    // const config = {
    //     type: 'bar',
    //     data: data,
    //     options: {}
    // };
</script>

<script>
    // const myChart = new Chart(
    //     document.getElementById('myChart'),
    //     config
    // );
</script>